<Window
    x:Class="SedimentCoreApp.UI.Views.MainWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Avalonia.Svg.Skia"
    xmlns:vm="using:SedimentCoreApp.UI.ViewModels"
    Title="Sediment Core Workbench"
    Width="1200"
    Height="800"
    x:CompileBindings="True"
    x:DataType="vm:MainWindowViewModel"
    Background="Transparent"
    ExtendClientAreaChromeHints="PreferSystemChrome"
    ExtendClientAreaToDecorationsHint="True"
    SystemDecorations="None"
    TransparencyLevelHint="None">

    <Window.Styles>
        <!--  Title bar buttons  -->
        <Style Selector="Button.titleBarButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Width" Value="46" />
            <Setter Property="Height" Value="36" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Foreground" Value="#E0E0E0" />
            <Setter Property="FontSize" Value="16" />
        </Style>

        <Style Selector="Button.titleBarButton:pointerover">
            <Setter Property="Background" Value="#434343" />
        </Style>

        <Style Selector="Button.titleBarButton:pressed">
            <Setter Property="Background" Value="#545454" />
        </Style>

        <!--  Close button  -->
        <Style Selector="Button.titleBarButton.closeButton:pointerover">
            <Setter Property="Background" Value="#C0392B" />
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.titleBarButton.closeButton:pressed">
            <Setter Property="Background" Value="#922B21" />
        </Style>

        <!--  Windowed: rounded + subtle border (Word-like)  -->
        <Style Selector="Window[WindowState=Normal] &gt; Border#WindowFrameBorder">
            <Setter Property="CornerRadius" Value="8,8,0,0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#33000000" />
        </Style>

        <!--  Maximised: no rounding, no border  -->
        <Style Selector="Window[WindowState=Maximized] &gt; Border#WindowFrameBorder">
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

        <!--  Header toolbar buttons  -->
        <Style Selector="Button.headerButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <Style Selector="Button.headerButton:not(.active):pointerover">
            <Setter Property="Background" Value="#99FFFFFF" />
        </Style>

        <Style Selector="Button.headerButton.active">
            <Setter Property="Background" Value="#FFFFFFFF" />
            <Setter Property="Foreground" Value="Black" />
        </Style>

        <!--  Disable pointer events on active button content to prevent hover  -->
        <Style Selector="Button.headerButton.active /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="IsHitTestVisible" Value="False" />
        </Style>

        <Style Selector="Button.headerButton:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#FFFFFFFF" />
        </Style>

        <!--  Menu bar buttons  -->
        <Style Selector="Button.menuButton">
            <Setter Property="Background" Value="#CCCCCC" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#CCCCCC" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="0,0" />
        </Style>

        <Style Selector="Button.menuButton:pointerover">
            <Setter Property="Background" Value="#D0D0D0" />
            <Setter Property="BorderBrush" Value="#999999" />
        </Style>

        <Style Selector="Button.menuButton:pressed">
            <Setter Property="Background" Value="#C0C0C0" />
        </Style>

        <!--  MATLAB-style tabs  -->
        <Style Selector="TabControl">
            <Setter Property="Background" Value="#F5F5F5" />
            <Setter Property="Padding" Value="0" />
        </Style>
        
        <Style Selector="TabControl /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="Margin" Value="0" />
        </Style>
        
        <Style Selector="TabControl /template/ Border#PART_SelectedContentHost">
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <Style Selector="TabItem">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Foreground" Value="#404040" />
            <Setter Property="Background" Value="#E0E0E0" />
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="Margin" Value="0,-1,0,0" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <Style Selector="TabItem:pointerover">
            <Setter Property="Background" Value="#ECECEC" />
        </Style>

        <Style Selector="TabItem:selected">
            <Setter Property="Background" Value="#FFFFFF" />
            <Setter Property="Foreground" Value="#000000" />
            <Setter Property="FontWeight" Value="Normal" />
        </Style>

        <Style Selector="TabItem:selected /template/ Border#PART_SelectedPipe">
            <Setter Property="Background" Value="#0078D4" />
            <Setter Property="Height" Value="3" />
        </Style>
    </Window.Styles>

    <!--  OUTER FRAME (no local border props!)  -->
    <Border
        x:Name="WindowFrameBorder"
        Padding="0"
        Background="#F0F0F0"
        CornerRadius="8,8,0,0">

        <!--  MAIN LAYOUT  -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="80" />
                <RowDefinition Height="100" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="300" />
            </Grid.ColumnDefinitions>

            <!--  HEADER  -->
            <Panel
                Grid.Row="0"
                Grid.ColumnSpan="3"
                PointerPressed="TitleBar_PointerPressed">
                <!--  Solid Background  -->
                <Border Background="#7C444E" />
                <!--  SVG Pattern with gradient fade  -->
                <Panel>
                    <svg:Svg Path="/Assets/Images/topography.svg" Stretch="UniformToFill" />
                    <Panel.OpacityMask>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                            <GradientStop Offset="0" Color="#00000000" />
                            <GradientStop Offset="1" Color="#26FFFFFF" />
                        </LinearGradientBrush>
                    </Panel.OpacityMask>
                </Panel>
                <!--  Content  -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40" />
                        <RowDefinition Height="40" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="0"
                        Margin="8,8,0,0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            FontSize="14"
                            FontWeight="Normal"
                            Foreground="White"
                            Text="Vis" />
                    </StackPanel>

                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Orientation="Horizontal">
                        <Button
                            Classes="titleBarButton"
                            Click="MinimizeButton_Click"
                            Content="—" />
                        <Button
                            x:Name="MaxRestoreButton"
                            Classes="titleBarButton"
                            Click="MaxRestoreButton_Click"
                            Content="□" />
                        <Button
                            Classes="titleBarButton closeButton"
                            Click="CloseButton_Click"
                            Content="✕" />
                    </StackPanel>

                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="0"
                        Margin="4,8,0,0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="4">
                        <Button
                            x:Name="FileButton"
                            Width="90"
                            Height="36"
                            Classes="headerButton"
                            Click="ToolButton_Click"
                            Content="File" />
                        <Button
                            x:Name="HomeButton"
                            Width="90"
                            Height="36"
                            Classes="headerButton"
                            Click="ToolButton_Click"
                            Content="Home" />
                        <Button
                            x:Name="AnalysisButton"
                            Width="90"
                            Height="36"
                            Classes="headerButton"
                            Click="ToolButton_Click"
                            Content="Analysis" />
                        <Button
                            x:Name="MappingButton"
                            Width="90"
                            Height="36"
                            Classes="headerButton"
                            Click="ToolButton_Click"
                            Content="Mapping" />
                        <Button
                            x:Name="ExportButton"
                            Width="90"
                            Height="36"
                            Classes="headerButton"
                            Click="ToolButton_Click"
                            Content="Export" />
                    </StackPanel>
                </Grid>
            </Panel>

            <!--  MENU BAR  -->
            <Border
                Grid.Row="1"
                Grid.ColumnSpan="3"
                Background="#FFFFFF"
                BorderBrush="#DDDDDD"
                BorderThickness="0,0,0,1">
                <Grid x:Name="MenuBar">
                    <!--  Default / None  -->
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.None}}">
                        <StackPanel.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </StackPanel.Transitions>
                        <StackPanel.RenderTransform>
                            <TranslateTransform X="0" />
                        </StackPanel.RenderTransform>
                        <TextBlock
                            FontSize="14"
                            Foreground="#999"
                            Text="Select a tool from the header" />
                    </StackPanel>
                    
                    <!--  File Menu  -->
                    <ItemsControl
                        Margin="16,0"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding ToolMenus[0].Buttons}"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.File}}">
                        <ItemsControl.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </ItemsControl.Transitions>
                        <ItemsControl.RenderTransform>
                            <TranslateTransform X="0" />
                        </ItemsControl.RenderTransform>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0" Padding="8,4">
                                    <StackPanel>
                                        <svg:Svg Width="32" Height="32" Path="{Binding IconPath}" />
                                        <TextBlock 
                                            Text="{Binding Label}" 
                                            FontSize="10" 
                                            HorizontalAlignment="Center" 
                                            Margin="0,4,0,0" 
                                            Foreground="#333333" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--  Home Menu  -->
                    <ItemsControl
                        Margin="16,0"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding ToolMenus[1].Buttons}"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.Home}}">
                        <ItemsControl.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </ItemsControl.Transitions>
                        <ItemsControl.RenderTransform>
                            <TranslateTransform X="0" />
                        </ItemsControl.RenderTransform>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0" Padding="8,4">
                                    <StackPanel>
                                        <svg:Svg Width="32" Height="32" Path="{Binding IconPath}" />
                                        <TextBlock 
                                            Text="{Binding Label}" 
                                            FontSize="10" 
                                            HorizontalAlignment="Center" 
                                            Margin="0,4,0,0" 
                                            Foreground="#333333" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--  Analysis Menu  -->
                    <ItemsControl
                        Margin="16,0"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding ToolMenus[2].Buttons}"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.Analysis}}">
                        <ItemsControl.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </ItemsControl.Transitions>
                        <ItemsControl.RenderTransform>
                            <TranslateTransform X="0" />
                        </ItemsControl.RenderTransform>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0" Padding="8,4">
                                    <StackPanel>
                                        <svg:Svg Width="32" Height="32" Path="{Binding IconPath}" />
                                        <TextBlock 
                                            Text="{Binding Label}" 
                                            FontSize="10" 
                                            HorizontalAlignment="Center" 
                                            Margin="0,4,0,0" 
                                            Foreground="#333333" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--  Mapping Menu  -->
                    <ItemsControl
                        Margin="16,0"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding ToolMenus[3].Buttons}"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.Mapping}}">
                        <ItemsControl.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </ItemsControl.Transitions>
                        <ItemsControl.RenderTransform>
                            <TranslateTransform X="0" />
                        </ItemsControl.RenderTransform>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0" Padding="8,4">
                                    <StackPanel>
                                        <svg:Svg Width="32" Height="32" Path="{Binding IconPath}" />
                                        <TextBlock 
                                            Text="{Binding Label}" 
                                            FontSize="10" 
                                            HorizontalAlignment="Center" 
                                            Margin="0,4,0,0" 
                                            Foreground="#333333" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--  Export Menu  -->
                    <ItemsControl
                        Margin="16,0"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding ToolMenus[4].Buttons}"
                        IsVisible="{Binding CurrentTool, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:ActiveTool.Export}}">
                        <ItemsControl.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                            </Transitions>
                        </ItemsControl.Transitions>
                        <ItemsControl.RenderTransform>
                            <TranslateTransform X="0" />
                        </ItemsControl.RenderTransform>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0" Padding="8,4">
                                    <StackPanel>
                                        <svg:Svg Width="32" Height="32" Path="{Binding IconPath}" />
                                        <TextBlock 
                                            Text="{Binding Label}" 
                                            FontSize="10" 
                                            HorizontalAlignment="Center" 
                                            Margin="0,4,0,0" 
                                            Foreground="#333333" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </Border>

            <!--  LEFT PANEL  -->
            <Border
                Grid.Row="2"
                Grid.Column="0"
                Background="#F0F0F0">
                <Border
                    Margin="8,8,4,8"
                    Background="#FFFFFF"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1"
                    CornerRadius="1">
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="Left panel" />
                </Border>
            </Border>

            <!--  CENTRE PANEL  -->
            <Border
                Grid.Row="2"
                Grid.Column="1"
                Background="#F0F0F0">
                <TabControl
                    Margin="4,8,4,8"
                    Background="#F0F0F0"
                    TabStripPlacement="Top">
                    <TabItem Header="Tab 1 aaaaaaaaaaa">
                        <Border
                            Background="#FFFFFF"
                            BorderBrush="#DDDDDD"
                            BorderThickness="1"
                            CornerRadius="1">
                            <Panel Background="#FFFFFF">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#999999"
                                    Text="Placeholder content for Tab 1" />
                            </Panel>
                        </Border>
                    </TabItem>
                    <TabItem Header="Tab 2">
                        <Border
                            Background="#FFFFFF"
                            BorderBrush="#DDDDDD"
                            BorderThickness="1"
                            CornerRadius="1">
                            <Panel Background="#FFFFFF">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#999999"
                                    Text="Placeholder content for Tab 2" />
                            </Panel>
                        </Border>
                    </TabItem>
                    <TabItem Header="Tab 3">
                        <Border
                            Background="#FFFFFF"
                            BorderBrush="#DDDDDD"
                            BorderThickness="1"
                            CornerRadius="1">
                            <Panel Background="#FFFFFF">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#999999"
                                    Text="Placeholder content for Tab 3" />
                            </Panel>
                        </Border>
                    </TabItem>
                </TabControl>
            </Border>

            <!--  RIGHT PANEL  -->
            <Border
                Grid.Row="2"
                Grid.Column="2"
                Background="#F0F0F0">
                <Border
                    Margin="4,8,8,8"
                    Background="#FFFFFF"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1"
                    CornerRadius="1">
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="Right panel" />
                </Border>
            </Border>

            <!--  STATUS BAR  -->
            <Border
                Grid.Row="3"
                Grid.ColumnSpan="3"
                Background="#FFFFFFFF"
                BoxShadow="0 -1 3 0 #05000000, 0 0 0 1 #261B1F23">
                <TextBlock
                    Margin="2"
                    Foreground="White"
                    Text="Status bar" />
            </Border>
        </Grid>
    </Border>
</Window>
